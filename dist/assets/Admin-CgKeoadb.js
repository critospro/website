var ae=Object.defineProperty,re=Object.defineProperties;var ie=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var q=(s,r,t)=>r in s?ae(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t,g=(s,r)=>{for(var t in r||(r={}))B.call(r,t)&&q(s,t,r[t]);if(M)for(var t of M(r))R.call(r,t)&&q(s,t,r[t]);return s},f=(s,r)=>re(s,ie(r));var E=(s,r)=>{var t={};for(var l in s)B.call(s,l)&&r.indexOf(l)<0&&(t[l]=s[l]);if(s!=null&&M)for(var l of M(s))r.indexOf(l)<0&&R.call(s,l)&&(t[l]=s[l]);return t};var _=(s,r,t)=>new Promise((l,u)=>{var h=i=>{try{d(t.next(i))}catch(c){u(c)}},v=i=>{try{d(t.throw(i))}catch(c){u(c)}},d=i=>i.done?l(i.value):Promise.resolve(i.value).then(h,v);d((t=t.apply(s,r)).next())});import{j as e,c as le,b as W,p as ne,a as G,e as oe}from"./ui-BaHh_PDK.js";import{r as j}from"./vendor-DV1f2hfo.js";import{B as P,s as y}from"./client-C2yhLZEv.js";import{L as b,I as N}from"./label-Bor1O0BV.js";import{c as F,d as p,e as ce,f as de,a as z}from"./index-bsRtcvq8.js";import{L as I}from"./loader-circle-Bb3UvPZ0.js";import{U as ue,a as he,S as me,P as ge}from"./ProjectCard-eyXnivoN.js";import{u as pe}from"./useProjects-DXQRdMu3.js";import{u as xe}from"./useQuery-DSPDO9qK.js";import{u as L,P as fe}from"./useMutation-Bu70clFN.js";import{u as je,T as ve,a as be,b as V,c as A}from"./tabs-CQKSgWdH.js";import{C as ye,a as we,b as Ne}from"./card-HLq6nJpV.js";import{D as H,e as Pe,a as $,b as Q,c as K}from"./dialog-CxsE3Ocs.js";import{u as Ce}from"./router-CYBj0wdM.js";import"./utils-6gDWDllp.js";import"./index-1JOOFrA2.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=F("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=F("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=F("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=F("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Ue=({onUploadComplete:s})=>{const[r,t]=j.useState(!1),[l,u]=j.useState({title:"",client:"",date:""}),h=(d,i)=>{u(c=>f(g({},c),{[d]:i}))},v=d=>_(void 0,null,function*(){var c;const i=(c=d.target.files)==null?void 0:c[0];if(i){if(!i.type.startsWith("video/")){p.error("Please select a video file");return}if(i.size>100*1024*1024){p.error("Video file must be less than 100MB");return}if(!l.title.trim()||!l.client.trim()||!l.date.trim()){p.error("Please fill in all project details");return}t(!0);try{const{data:{user:o}}=yield y.auth.getUser();if(!o){p.error("Please sign in to upload videos");return}const m=i.name.split(".").pop(),a=`${o.id}/${Date.now()}_${l.title.replace(/[^a-zA-Z0-9]/g,"_")}.${m}`;p.info("Uploading video...");const{error:x}=yield y.storage.from("videos").upload(a,i);if(x)throw new Error(`Upload failed: ${x.message}`);p.info("Generating thumbnail...");const{data:C,error:w}=yield y.functions.invoke("generate-thumbnail",{body:{videoPath:a}});w&&console.warn("Thumbnail generation failed:",w);const{data:{publicUrl:k}}=y.storage.from("videos").getPublicUrl(a),{data:S,error:n}=yield y.from("projects").insert({title:l.title,client:l.client,date:l.date,video_url:k,thumbnail_url:(C==null?void 0:C.thumbnailUrl)||null,is_video:!0,user_id:o.id}).select().single();if(n)throw new Error(`Database error: ${n.message}`);p.success("Video uploaded successfully!"),u({title:"",client:"",date:""}),d.target.value="",s==null||s(S)}catch(o){console.error("Upload error:",o),p.error(o instanceof Error?o.message:"Upload failed")}finally{t(!1)}}});return e.jsxs("div",{className:"space-y-6 p-6 bg-card rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"Upload New Project Video"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"title",children:"Project Title"}),e.jsx(N,{id:"title",value:l.title,onChange:d=>h("title",d.target.value),placeholder:"Enter project title",disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"client",children:"Client"}),e.jsx(N,{id:"client",value:l.client,onChange:d=>h("client",d.target.value),placeholder:"Enter client name",disabled:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"date",children:"Date"}),e.jsx(N,{id:"date",type:"date",value:l.date,onChange:d=>h("date",d.target.value),disabled:r})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"video",children:"Video File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{id:"video",type:"file",accept:"video/*",onChange:v,disabled:r,className:"flex-1"}),e.jsxs(P,{disabled:r,className:"flex items-center gap-2",children:[r?e.jsx(I,{className:"w-4 h-4 animate-spin"}):e.jsx(ue,{className:"w-4 h-4"}),r?"Uploading...":"Upload"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Supported formats: MP4, WebM, QuickTime. Max size: 100MB"})]})]})},Te=()=>{const s=ce(),{data:r=[],isLoading:t,error:l}=xe({queryKey:["pages"],queryFn:()=>_(void 0,null,function*(){const{data:i,error:c}=yield y.from("pages").select("*").order("sort_order",{ascending:!0}).order("created_at",{ascending:!1});if(c)throw c;return i}),staleTime:5*60*1e3}),u=L({mutationFn:i=>_(void 0,null,function*(){const{data:{user:c}}=yield y.auth.getUser();if(!c)throw new Error("User not authenticated");const{data:o,error:m}=yield y.from("pages").insert([f(g({},i),{user_id:c.id})]).select().single();if(m)throw m;return o}),onSuccess:()=>{s.invalidateQueries({queryKey:["pages"]}),p.success("Page created successfully!")},onError:i=>{p.error("Error creating page: "+i.message)}}),h=L({mutationFn:o=>_(void 0,null,function*(){var m=o,{id:i}=m,c=E(m,["id"]);const{data:a,error:x}=yield y.from("pages").update(c).eq("id",i).select().single();if(x)throw x;return a}),onSuccess:()=>{s.invalidateQueries({queryKey:["pages"]}),p.success("Page updated successfully!")},onError:i=>{p.error("Error updating page: "+i.message)}}),v=L({mutationFn:i=>_(void 0,null,function*(){const{error:c}=yield y.from("pages").delete().eq("id",i);if(c)throw c}),onSuccess:()=>{s.invalidateQueries({queryKey:["pages"]}),p.success("Page deleted successfully!")},onError:i=>{p.error("Error deleting page: "+i.message)}}),d=()=>{s.invalidateQueries({queryKey:["pages"]})};return{pages:r,isLoading:t,error:l,createPage:u.mutate,updatePage:h.mutate,deletePage:v.mutate,isCreating:u.isPending,isUpdating:h.isPending,isDeleting:v.isPending,invalidatePages:d}};var D="Switch",[Me,ss]=le(D),[Fe,De]=Me(D),X=j.forwardRef((s,r)=>{const U=s,{__scopeSwitch:t,name:l,checked:u,defaultChecked:h,required:v,disabled:d,value:i="on",onCheckedChange:c,form:o}=U,m=E(U,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),[a,x]=j.useState(null),C=W(r,T=>x(T)),w=j.useRef(!1),k=a?o||!!a.closest("form"):!0,[S,n]=ne({prop:u,defaultProp:h!=null?h:!1,onChange:c,caller:D});return e.jsxs(Fe,{scope:t,checked:S,disabled:d,children:[e.jsx(G.button,f(g({type:"button",role:"switch","aria-checked":S,"aria-required":v,"data-state":ee(S),"data-disabled":d?"":void 0,disabled:d,value:i},m),{ref:C,onClick:oe(s.onClick,T=>{n(te=>!te),k&&(w.current=T.isPropagationStopped(),w.current||T.stopPropagation())})})),k&&e.jsx(J,{control:a,bubbles:!w.current,name:l,value:i,checked:S,required:v,disabled:d,form:o,style:{transform:"translateX(-100%)"}})]})});X.displayName=D;var Y="SwitchThumb",Z=j.forwardRef((s,r)=>{const h=s,{__scopeSwitch:t}=h,l=E(h,["__scopeSwitch"]),u=De(Y,t);return e.jsx(G.span,f(g({"data-state":ee(u.checked),"data-disabled":u.disabled?"":void 0},l),{ref:r}))});Z.displayName=Y;var Le="SwitchBubbleInput",J=j.forwardRef((v,h)=>{var d=v,{__scopeSwitch:s,control:r,checked:t,bubbles:l=!0}=d,u=E(d,["__scopeSwitch","control","checked","bubbles"]);const i=j.useRef(null),c=W(i,h),o=je(t),m=de(r);return j.useEffect(()=>{const a=i.current;if(!a)return;const x=window.HTMLInputElement.prototype,w=Object.getOwnPropertyDescriptor(x,"checked").set;if(o!==t&&w){const k=new Event("click",{bubbles:l});w.call(a,t),a.dispatchEvent(k)}},[o,t,l]),e.jsx("input",f(g({type:"checkbox","aria-hidden":!0,defaultChecked:t},u),{tabIndex:-1,ref:c,style:f(g(g({},u.style),m),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))});J.displayName=Le;function ee(s){return s?"checked":"unchecked"}var se=X,Ie=Z;const O=j.forwardRef((l,t)=>{var u=l,{className:s}=u,r=E(u,["className"]);return e.jsx(se,f(g({className:z("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s)},r),{ref:t,children:e.jsx(Ie,{className:z("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}))});O.displayName=se.displayName;const Oe=()=>{const{pages:s,isLoading:r,createPage:t,updatePage:l,deletePage:u,isCreating:h,isUpdating:v,isDeleting:d}=Te(),[i,c]=j.useState(!1),[o,m]=j.useState(null),[a,x]=j.useState({slug:"",title:"",is_published:!0,content:{},sort_order:0}),C=()=>{if(!a.slug||!a.title){p.error("Slug and title are required");return}t(a),x({slug:"",title:"",is_published:!0,content:{},sort_order:0}),c(!1)},w=()=>{if(!o.slug||!o.title){p.error("Slug and title are required");return}l(o),m(null)},k=(n,U)=>{window.confirm(`Are you sure you want to delete "${U}"?`)&&u(n)},S=n=>{l(f(g({},n),{is_published:!n.is_published}))};return r?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-light text-foreground",children:"Manage Pages"}),e.jsxs(H,{open:i,onOpenChange:c,children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4"}),"Create Page"]})}),e.jsxs($,{className:"sm:max-w-md",children:[e.jsx(Q,{children:e.jsx(K,{children:"Create New Page"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"slug",children:"Page Slug"}),e.jsx(N,{id:"slug",placeholder:"about-us",value:a.slug,onChange:n=>x(f(g({},a),{slug:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"title",children:"Page Title"}),e.jsx(N,{id:"title",placeholder:"About Us",value:a.title,onChange:n=>x(f(g({},a),{title:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"sort_order",children:"Sort Order"}),e.jsx(N,{id:"sort_order",type:"number",value:a.sort_order,onChange:n=>x(f(g({},a),{sort_order:parseInt(n.target.value)||0}))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"published",checked:a.is_published,onCheckedChange:n=>x(f(g({},a),{is_published:n}))}),e.jsx(b,{htmlFor:"published",children:"Published"})]}),e.jsx(P,{onClick:C,className:"w-full",disabled:h,children:h?"Creating...":"Create Page"})]})]})]})]}),s.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No pages created yet."})}):e.jsx("div",{className:"grid gap-4",children:s.map(n=>e.jsx(ye,{className:"hover:shadow-lg transition-shadow",children:e.jsx(we,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Ne,{className:"text-lg",children:n.title}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["/",n.slug]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>S(n),className:"flex items-center gap-1",children:n.is_published?e.jsxs(e.Fragment,{children:[e.jsx(Se,{className:"w-4 h-4"}),"Published"]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4"}),"Draft"]})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>m(g({},n)),children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(P,{variant:"ghost",size:"sm",onClick:()=>k(n.id,n.title),className:"text-destructive hover:text-destructive",children:e.jsx(Ee,{className:"w-4 h-4"})})]})]})})},n.id))}),e.jsx(H,{open:!!o,onOpenChange:()=>m(null),children:e.jsxs($,{className:"sm:max-w-md",children:[e.jsx(Q,{children:e.jsx(K,{children:"Edit Page"})}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"edit-slug",children:"Page Slug"}),e.jsx(N,{id:"edit-slug",value:o.slug,onChange:n=>m(f(g({},o),{slug:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"edit-title",children:"Page Title"}),e.jsx(N,{id:"edit-title",value:o.title,onChange:n=>m(f(g({},o),{title:n.target.value}))})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"edit-sort-order",children:"Sort Order"}),e.jsx(N,{id:"edit-sort-order",type:"number",value:o.sort_order,onChange:n=>m(f(g({},o),{sort_order:parseInt(n.target.value)||0}))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{id:"edit-published",checked:o.is_published,onCheckedChange:n=>m(f(g({},o),{is_published:n}))}),e.jsx(b,{htmlFor:"edit-published",children:"Published"})]}),e.jsx(P,{onClick:w,className:"w-full",disabled:v,children:v?"Updating...":"Update Page"})]})]})})]})},ts=()=>{const[s,r]=j.useState(null),[t,l]=j.useState(!0),u=Ce(),{projects:h,isLoading:v,invalidateProjects:d}=pe();j.useEffect(()=>{i()},[]);const i=()=>_(void 0,null,function*(){try{const{data:{user:a},error:x}=yield y.auth.getUser();if(x||!a){u("/auth");return}r(a)}catch(a){console.error("Auth error:",a),u("/auth")}finally{l(!1)}}),c=()=>_(void 0,null,function*(){try{yield y.auth.signOut(),u("/")}catch(a){p.error("Error signing out")}}),o=()=>{d(),p.success("Project uploaded successfully!")},m=()=>{u("/site-builder")};return t?e.jsx("div",{className:"min-h-screen bg-black flex items-center justify-center",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-foreground"})}):e.jsx("div",{className:"min-h-screen bg-black pt-20 px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-12",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-light text-foreground mb-2",children:"Admin Panel"}),e.jsxs("p",{className:"text-muted-foreground",children:["Welcome, ",s==null?void 0:s.email]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(P,{onClick:m,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-4 h-4"}),"Site Builder"]}),e.jsxs(P,{onClick:c,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),"Sign Out"]})]})]}),e.jsxs(ve,{defaultValue:"projects",className:"w-full",children:[e.jsxs(be,{className:"grid w-full grid-cols-2",children:[e.jsx(V,{value:"projects",children:"Projects"}),e.jsx(V,{value:"pages",children:"Pages"})]}),e.jsxs(A,{value:"projects",className:"space-y-8",children:[e.jsx("div",{className:"mb-12",children:e.jsx(Ue,{onUploadComplete:o})}),e.jsxs("div",{className:"space-y-8",children:[e.jsx("h2",{className:"text-2xl font-light text-foreground",children:"Your Projects"}),v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(I,{className:"w-8 h-8 animate-spin text-foreground"})}):h.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"No projects uploaded yet."})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:h.map(a=>e.jsx(ge,{title:a.title,client:a.client,date:a.date,image:a.thumbnail_url||"/placeholder.svg",isVideo:a.is_video,videoUrl:a.video_url,thumbnailUrl:a.thumbnail_url},a.id))})]})]}),e.jsx(A,{value:"pages",className:"mt-8",children:e.jsx(Oe,{})})]})]})})};export{ts as default};
